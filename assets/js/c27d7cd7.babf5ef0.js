(self.webpackChunkdevelop_qa=self.webpackChunkdevelop_qa||[]).push([[32],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return u},kt:function(){return m}});var r=n(7294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n,r,s={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var i=r.createContext({}),p=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(i.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,s=e.mdxType,a=e.originalType,i=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=s,y=d["".concat(i,".").concat(m)]||d[m]||c[m]||a;return n?r.createElement(y,o(o({ref:t},u),{},{components:n})):r.createElement(y,o({ref:t},u))}));function m(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var a=n.length,o=new Array(a);o[0]=d;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:s,o[1]=l;for(var p=2;p<a;p++)o[p]=n[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2110:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return o},metadata:function(){return l},toc:function(){return i},default:function(){return u}});var r=n(2122),s=n(9756),a=(n(7294),n(3905)),o={id:"mysql",title:"mysql\u5e38\u89c1\u8fd0\u7ef4\u95ee\u9898",sidebar_label:"mysql\u5e38\u89c1\u8fd0\u7ef4\u95ee\u9898",slug:"/app-info/mysql"},l={unversionedId:"app-info/mysql/mysql",id:"app-info/mysql/mysql",isDocsHomePage:!1,title:"1.centos 8\u5b89\u88c5mysql",description:"On CentOS 8, MySQL version 8 is available from the default repositories.",source:"@site/docs/app-info/mysql/readme.md",sourceDirName:"app-info/mysql",slug:"/app-info/mysql",permalink:"/developer-qa/docs/app-info/mysql",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/app-info/mysql/readme.md",version:"current",lastUpdatedAt:1641533774,formattedLastUpdatedAt:"1/7/2022",sidebar_label:"mysql\u5e38\u89c1\u8fd0\u7ef4\u95ee\u9898",frontMatter:{id:"mysql",title:"mysql\u5e38\u89c1\u8fd0\u7ef4\u95ee\u9898",sidebar_label:"mysql\u5e38\u89c1\u8fd0\u7ef4\u95ee\u9898",slug:"/app-info/mysql"},sidebar:"docs",previous:{title:"mavn\u5e38\u89c1\u8fd0\u7ef4\u95ee\u9898",permalink:"/developer-qa/docs/app-info/maven"},next:{title:"webstorm\u5e38\u89c1\u95ee\u9898",permalink:"/developer-qa/docs/ide-info/webstorm"}},i=[{value:"Step 2 \u2014 Securing MySQL(reset root password)",id:"step-2--securing-mysqlreset-root-password",children:[{value:"3.\u8fdc\u7a0b\u8bbf\u95eemysql",id:"3\u8fdc\u7a0b\u8bbf\u95eemysql",children:[]},{value:"4.\u67e5\u8be2mysql\u6b7b\u9501\u5e76\u6740\u6b7b\u8fdb\u7a0b",id:"4\u67e5\u8be2mysql\u6b7b\u9501\u5e76\u6740\u6b7b\u8fdb\u7a0b",children:[]},{value:"5.\u5bfc\u51fa,\u5bfc\u5165mysql\u6570\u636e\u5e93\u547d\u4ee4",id:"5\u5bfc\u51fa\u5bfc\u5165mysql\u6570\u636e\u5e93\u547d\u4ee4",children:[]}]},{value:"2. \u81ea\u52a8\u8f93\u5165msyql\u5bc6\u7801:",id:"2-\u81ea\u52a8\u8f93\u5165msyql\u5bc6\u7801",children:[{value:"\u7b2c\u4e00\u79cd\u65b9\u6cd5:",id:"\u7b2c\u4e00\u79cd\u65b9\u6cd5",children:[]},{value:"\u7b2c\u4e8c\u79cd\u65b9\u6cd5:",id:"\u7b2c\u4e8c\u79cd\u65b9\u6cd5",children:[]}]},{value:"3. docker\u4e0a\u90e8\u7f72\u5e76\u8fdc\u7a0b\u8bbf\u95eemysql",id:"3-docker\u4e0a\u90e8\u7f72\u5e76\u8fdc\u7a0b\u8bbf\u95eemysql",children:[{value:"(1) docker-compose\u914d\u7f6e:",id:"1-docker-compose\u914d\u7f6e",children:[]},{value:"(2) \u8bbe\u7f6e\u8fdc\u7a0b\u8bbf\u95ee",id:"2-\u8bbe\u7f6e\u8fdc\u7a0b\u8bbf\u95ee",children:[]}]}],p={toc:i};function u(e){var t=e.components,n=(0,s.Z)(e,["components"]);return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"On CentOS 8, MySQL version 8 is available from the default repositories."),(0,a.kt)("p",null,"Run the following command to install the\xa0",(0,a.kt)("inlineCode",{parentName:"p"},"mysql-server"),"\xa0package and a number of its dependencies:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"dnf install mysql-server\n")),(0,a.kt)("p",null,"When prompted, press\xa0",(0,a.kt)("inlineCode",{parentName:"p"},"y"),"\xa0and then\xa0",(0,a.kt)("inlineCode",{parentName:"p"},"ENTER"),"\xa0to confirm that you want to proceed:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Output. . .\nInstall  49 Packages\n\nTotal download size: 46 M\nInstalled size: 252 M\nIs this ok [y/N]: y\n")),(0,a.kt)("p",null,"With that, MySQL is installed on your server but it isn\u2019t yet operational. The package you just installed configures MySQL to run as a\xa0",(0,a.kt)("inlineCode",{parentName:"p"},"systemd"),"\xa0service named\xa0",(0,a.kt)("inlineCode",{parentName:"p"},"mysqld.service"),". In order to use MySQL, you will need to start it with the\xa0",(0,a.kt)("inlineCode",{parentName:"p"},"systemctl"),"\xa0command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl start mysqld.service\n")),(0,a.kt)("p",null,"Next, set MySQL to start whenever the server boots up with the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl enable mysqld\n")),(0,a.kt)("h2",{id:"step-2--securing-mysqlreset-root-password"},"Step 2 \u2014 Securing MySQL(reset root password)"),(0,a.kt)("p",null,"MySQL includes a security script that allows you to change some default configuration options in order to improve MySQL\u2019s security."),(0,a.kt)("p",null,"To use the security script, run the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo mysql_secure_installation\n")),(0,a.kt)("p",null,"This will take you through a series of prompts asking if you want to make certain changes to your MySQL installation\u2019s security options. The first prompt will ask whether you\u2019d like to set up the Validate Password Plugin, which you can use to test the strength of your MySQL password."),(0,a.kt)("p",null,"If you elect to set up the Validate Password Plugin, the script will ask you to choose a password validation level. The strongest level \u2014 which you select by entering\xa0",(0,a.kt)("inlineCode",{parentName:"p"},"2"),"\xa0\u2014 will require your password to be at least eight characters long and include a mix of uppercase, lowercase, numeric, and special characters:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"OutputSecuring the MySQL server deployment.\n\nConnecting to MySQL using a blank password.\n\nVALIDATE PASSWORD COMPONENT can be used to test passwords\nand improve security. It checks the strength of password\nand allows the users to set only those passwords which are\nsecure enough. Would you like to setup VALIDATE PASSWORD component?\n\nPress y|Y for Yes, any other key for No: Y\n\nThere are three levels of password validation policy:\n\nLOW    Length >= 8\nMEDIUM Length >= 8, numeric, mixed case, and special characters\nSTRONG Length >= 8, numeric, mixed case, special characters and dictionary                  file\n\nPlease enter 0 = LOW, 1 = MEDIUM and 2 = STRONG: 2\n")),(0,a.kt)("p",null,"Regardless of whether you choose to set up the Validate Password Plugin, the next prompt will be to set a password for the MySQL\xa0",(0,a.kt)("strong",{parentName:"p"},"root"),"\xa0user. Enter and then confirm a secure password of your choice:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"OutputPlease set the password for root here.\n\n\nNew password: \n\nRe-enter new password: \n")),(0,a.kt)("p",null,"If you used the Validate Password Plugin, you\u2019ll receive feedback on the strength of your new password. Then the script will ask if you want to continue with the password you just entered or if you want to enter a new one. Assuming you\u2019re satisfied with the strength of the password you just entered, enter\xa0",(0,a.kt)("inlineCode",{parentName:"p"},"Y"),"\xa0to continue the script:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"OutputEstimated strength of the password: 100 \nDo you wish to continue with the password provided?(Press y|Y for Yes, any other key for No) : Y\n")),(0,a.kt)("p",null,"Following that, you can press\xa0",(0,a.kt)("inlineCode",{parentName:"p"},"Y"),"\xa0and then\xa0",(0,a.kt)("inlineCode",{parentName:"p"},"ENTER"),"\xa0to accept the defaults for all the subsequent questions. This will remove some anonymous users and the test database, disable remote root logins, and load these new rules so that MySQL immediately respects the changes you have made."),(0,a.kt)("p",null,"With that, you\u2019ve installed and secured MySQL on your CentOS 8 server. As a final step, we will test that the database is accessible and working as expected."),(0,a.kt)("h3",{id:"3\u8fdc\u7a0b\u8bbf\u95eemysql"},"3.\u8fdc\u7a0b\u8bbf\u95eemysql"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-output"},"update user set host='%' where user='root';\nflush privileges;\n")),(0,a.kt)("h4",{id:"3commysqljdbcpackettoobigexception"},"3.",(0,a.kt)("a",{parentName:"h4",href:"https://stackoverflow.com/questions/11320236/com-mysql-jdbc-packettoobigexception"},"com.mysql.jdbc.PacketTooBigException")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"SET GLOBAL max_allowed_packet = 1024*1024*14;\n")),(0,a.kt)("h3",{id:"4\u67e5\u8be2mysql\u6b7b\u9501\u5e76\u6740\u6b7b\u8fdb\u7a0b"},"4.\u67e5\u8be2mysql\u6b7b\u9501\u5e76\u6740\u6b7b\u8fdb\u7a0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"SELECT trx_mysql_thread_id, trx_state, trx_query\nFROM INFORMATION_SCHEMA.INNODB_TRX;\n")),(0,a.kt)("p",null,"\u6740\u6b7b\u8fdb\u7a0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"\u6740\u6389\u8fdb\u7a0b          KILL \u8fdb\u7a0bid;\n")),(0,a.kt)("h3",{id:"5\u5bfc\u51fa\u5bfc\u5165mysql\u6570\u636e\u5e93\u547d\u4ee4"},"5.\u5bfc\u51fa,\u5bfc\u5165mysql\u6570\u636e\u5e93\u547d\u4ee4"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"\u5bfc\u51fa:\nmysqldump -u root -p ry-vue > sql/all.sql\n\n\u5bfc\u5165:\n\nmysql -u root -p  ry-vue < sql/all.sql\n")),(0,a.kt)("h2",{id:"2-\u81ea\u52a8\u8f93\u5165msyql\u5bc6\u7801"},"2. \u81ea\u52a8\u8f93\u5165msyql\u5bc6\u7801:"),(0,a.kt)("h3",{id:"\u7b2c\u4e00\u79cd\u65b9\u6cd5"},"\u7b2c\u4e00\u79cd\u65b9\u6cd5:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"#!/usr/bin/env bash\n\nmysqldump -uroot -p123456 -hlocalhost --databases tao --tables gen_table gen_table_column sys_dict_data sys_dict_type  >sql/backupsetup.sql\n")),(0,a.kt)("h3",{id:"\u7b2c\u4e8c\u79cd\u65b9\u6cd5"},"\u7b2c\u4e8c\u79cd\u65b9\u6cd5:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'#!/usr/bin/expect\nspawn ./exportdb.sh\nexpect "Enter password:"\nsend "password\\n"\n\n\u6216\u8005\n\n#!/usr/bin/expect\nspawn ./importdb.sh\nexpect "Enter password:"\nsend "password\\n"\n')),(0,a.kt)("p",null,'\u8fd9\u91cc\u91cd\u70b9\u547d\u4ee4\u662f:spawn,expect,send,\u8fd9\u91cc\u7684"interact"\u53ef\u4ee5\u4e0d\u8981\n\u53ef\u4ee5\u4e0d\u8981\n\u6ce8\u610f:\n\u8fd9\u91cc\u7684'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"./exportdb.sh\n./importdb.sh\n")),(0,a.kt)("p",null,"\u8fd9\u91cc\u662f\u5fc5\u9700\u5206\u5f00\u5199\u7684,\u4e0d\u7136,\u81ea\u52a8\u8f93\u5165\u5bc6\u7801\u4f1a\u65e0\u6548"),(0,a.kt)("p",null,"1.\u5165\u53e3\u6587\u4ef6\u8981\u52a0\u5934:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"#!/usr/bin/expect\n")),(0,a.kt)("p",null,"2.exportdb.sh\u6587\u4ef6\u5185\u5bb9"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"#!/usr/bin/env bash\nmysqldump -u root -p ry-vue > sql/all.sql\n")),(0,a.kt)("p",null,"3.importdb.sh\u6587\u4ef6\u5185\u5bb9"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"#!/usr/bin/env bash\nmysql -u root -p  ry-vue < sql/all.sql\n")),(0,a.kt)("h2",{id:"3-docker\u4e0a\u90e8\u7f72\u5e76\u8fdc\u7a0b\u8bbf\u95eemysql"},"3. docker\u4e0a\u90e8\u7f72\u5e76\u8fdc\u7a0b\u8bbf\u95eemysql"),(0,a.kt)("h3",{id:"1-docker-compose\u914d\u7f6e"},"(1) docker-compose\u914d\u7f6e:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"# This configuration is intended for development purpose, it's **your** responsibility to harden it for production\nversion: '3.8'\nservices:\n  e2edemo-mysql:\n    image: mysql:8.0.23\n    volumes:\n     - ~/volumes/jhipster/e2edemo/mysql/:/var/lib/mysql/\n    environment:\n      MYSQL_ROOT_PASSWORD: password\n    # If you want to expose these ports outside your dev PC,\n    # remove the \"127.0.0.1:\" prefix\n    ports:\n      - 3306:3306\n    command: mysqld --lower_case_table_names=1 --skip-ssl --character_set_server=utf8mb4 --explicit_defaults_for_timestamp\n")),(0,a.kt)("h3",{id:"2-\u8bbe\u7f6e\u8fdc\u7a0b\u8bbf\u95ee"},"(2) \u8bbe\u7f6e\u8fdc\u7a0b\u8bbf\u95ee"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"\u8fdb\u5165\u5bb9\u5668:\n\ndocker exec -it app_e2edemo-mysql_1 bash\n\n\u767b\u9646 mysql \nmysql -uroot -p\n\nalter user 'root'@'%' identified with mysql_native_password by 'your-password';\n\nflush privileges;\n\n\u8bb0\u5f97\u9000\u51fa\u5bb9\u5668,\u5373\u53ef\n")))}u.isMDXComponent=!0}}]);