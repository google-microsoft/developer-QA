(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{69:function(e,n,r){"use strict";r.r(n),r.d(n,"frontMatter",(function(){return o})),r.d(n,"metadata",(function(){return s})),r.d(n,"toc",(function(){return l})),r.d(n,"default",(function(){return c}));var t=r(3),a=r(7),i=(r(0),r(97)),o={id:"ruoyi",title:"ruoyi\u5e38\u89c1\u8fd0\u7ef4\u95ee\u9898",sidebar_label:"ruoyi\u5e38\u89c1\u8fd0\u7ef4\u95ee\u9898",slug:"/app-info/ruoyi"},s={unversionedId:"app-info/java/ruoyi",id:"app-info/java/ruoyi",isDocsHomePage:!1,title:"ruoyi\u5e38\u89c1\u8fd0\u7ef4\u95ee\u9898",description:"1.\u5347\u7ea7jdk\u523015",source:"@site/docs/app-info/java/ruoyi.md",sourceDirName:"app-info/java",slug:"/app-info/ruoyi",permalink:"/developer-qa/docs/app-info/ruoyi",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/app-info/java/ruoyi.md",version:"current",lastUpdatedAt:1621072071,formattedLastUpdatedAt:"5/15/2021",sidebar_label:"ruoyi\u5e38\u89c1\u8fd0\u7ef4\u95ee\u9898",frontMatter:{id:"ruoyi",title:"ruoyi\u5e38\u89c1\u8fd0\u7ef4\u95ee\u9898",sidebar_label:"ruoyi\u5e38\u89c1\u8fd0\u7ef4\u95ee\u9898",slug:"/app-info/ruoyi"},sidebar:"docs",previous:{title:"java\u5e38\u89c1\u8fd0\u7ef4\u95ee\u9898",permalink:"/developer-qa/docs/app-info/java"},next:{title:"ruoyi-vue\u524d\u7aef\u5e38\u89c1\u95ee\u9898",permalink:"/developer-qa/docs/app-info/ruoyifontend"}},l=[{value:"1.\u5347\u7ea7jdk\u523015",id:"1\u5347\u7ea7jdk\u523015",children:[{value:"1.Execution default of goal org.springframework.boot:spring-boot-maven-plugin:2.1.1.RELEASE:repackage failed: Unsupported class file major version 59 -&gt; Help 1",id:"1execution-default-of-goal-orgspringframeworkbootspring-boot-maven-plugin211releaserepackage-failed-unsupported-class-file-major-version-59---help-1",children:[]},{value:"2.ruoyi-framework \u7684\u6a21\u5757\u4e0b\u52a0\u4ee5\u4e0b\u4f9d\u8d56",id:"2ruoyi-framework-\u7684\u6a21\u5757\u4e0b\u52a0\u4ee5\u4e0b\u4f9d\u8d56",children:[]},{value:"3.\u767b\u5f55\u51fa\u73b0DatatypeConverter\u5f02\u5e38",id:"3\u767b\u5f55\u51fa\u73b0datatypeconverter\u5f02\u5e38",children:[]}]},{value:"2.ruoyi-vue\u81ea\u5b9a\u4e49\u5bc6\u7801\u5339\u914d\u5668",id:"2ruoyi-vue\u81ea\u5b9a\u4e49\u5bc6\u7801\u5339\u914d\u5668",children:[{value:"(1).\u7b2c\u4e00\u6b65:\u91cd\u5199SecurityUtils.encryptPassword,SecurityUtils.matchesPassword\u8fd9\u4e24\u4e2a\u65b9\u6cd5",id:"1\u7b2c\u4e00\u6b65\u91cd\u5199securityutilsencryptpasswordsecurityutilsmatchespassword\u8fd9\u4e24\u4e2a\u65b9\u6cd5",children:[]},{value:"(2).\u7b2c\u4e8c\u6b65:\u5728SecurityConfig\u7c7b\u91cc\u914d\u7f6e\u81ea\u5df1\u7684\u5bc6\u7801\u5339\u914d\u5668",id:"2\u7b2c\u4e8c\u6b65\u5728securityconfig\u7c7b\u91cc\u914d\u7f6e\u81ea\u5df1\u7684\u5bc6\u7801\u5339\u914d\u5668",children:[]}]},{value:"3.\u5728ruoyi-vue\u52a0\u8c37\u6b4c\u9a8c\u8bc1\u7801",id:"3\u5728ruoyi-vue\u52a0\u8c37\u6b4c\u9a8c\u8bc1\u7801",children:[]},{value:"4.\u5b57\u6bb5\u65e5\u671f\u683c\u5f0f\u5316",id:"4\u5b57\u6bb5\u65e5\u671f\u683c\u5f0f\u5316",children:[]},{value:"5.\u81ea\u5b9a\u4e49dto\u8f6c\u5316\u5668,\u5982,\u628a\u6570\u7ec4\u8f6c\u6210String",id:"5\u81ea\u5b9a\u4e49dto\u8f6c\u5316\u5668\u5982\u628a\u6570\u7ec4\u8f6c\u6210string",children:[]},{value:"6.\u5e38\u89c1mybatis\u5b9e\u4f53html",id:"6\u5e38\u89c1mybatis\u5b9e\u4f53html",children:[]},{value:"7. import\u5bfc\u5165\u7684\u5b9e\u73b0",id:"7-import\u5bfc\u5165\u7684\u5b9e\u73b0",children:[{value:"(1) java \u5b9e\u73b0",id:"1-java-\u5b9e\u73b0",children:[]},{value:"(2) vue\u5b9e\u73b0",id:"2-vue\u5b9e\u73b0",children:[]}]},{value:"8.ruoyi\u591a\u6570\u636e\u6e90",id:"8ruoyi\u591a\u6570\u636e\u6e90",children:[]}],p={toc:l};function c(e){var n=e.components,r=Object(a.a)(e,["components"]);return Object(i.b)("wrapper",Object(t.a)({},p,r,{components:n,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"1\u5347\u7ea7jdk\u523015"},"1.\u5347\u7ea7jdk\u523015"),Object(i.b)("h3",{id:"1execution-default-of-goal-orgspringframeworkbootspring-boot-maven-plugin211releaserepackage-failed-unsupported-class-file-major-version-59---help-1"},"1.Execution default of goal org.springframework.boot:spring-boot-maven-plugin:2.1.1.RELEASE:repackage failed: Unsupported class file major version 59 -> ","[Help 1]"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-xml"},"\n<groupId>org.springframework.boot</groupId>\n<artifactId>spring-boot-maven-plugin</artifactId>\n<version>2.1.1.RELEASE</version>\n<configuration>\n<fork>true</fork> \x3c!-- \u5982\u679c\u6ca1\u6709\u8be5\u914d\u7f6e\uff0cdevtools\u4e0d\u4f1a\u751f\u6548 --\x3e\n</configuration>\n")),Object(i.b)("p",null,"\u8fd9\u91cc\u52a0spring-boot-maven-plugin\u63d2\u4ef6\u8981\u52a0class\u5165\u53e3:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-xml"},"\n<mainClass>com.ruoyi.RuoYiApplication</mainClass>\n        \u5982:\n\n<groupId>org.springframework.boot</groupId>\n<artifactId>spring-boot-maven-plugin</artifactId>\n<version>2.1.1.RELEASE</version>\n<configuration>\n<fork>true</fork> \x3c!-- \u5982\u679c\u6ca1\u6709\u8be5\u914d\u7f6e\uff0cdevtools\u4e0d\u4f1a\u751f\u6548 --\x3e\n<mainClass>com.ruoyi.RuoYiApplication</mainClass>\n</configuration>\n\n")),Object(i.b)("h3",{id:"2ruoyi-framework-\u7684\u6a21\u5757\u4e0b\u52a0\u4ee5\u4e0b\u4f9d\u8d56"},"2.ruoyi-framework \u7684\u6a21\u5757\u4e0b\u52a0\u4ee5\u4e0b\u4f9d\u8d56"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-xml"},"\n<dependency>\n    <groupId>javax.xml.bind</groupId>\n    <artifactId>jaxb-api</artifactId>\n    <version>2.3.0</version>\n</dependency>\n")),Object(i.b)("h3",{id:"3\u767b\u5f55\u51fa\u73b0datatypeconverter\u5f02\u5e38"},"3.\u767b\u5f55\u51fa\u73b0DatatypeConverter\u5f02\u5e38"),Object(i.b)("p",null,Object(i.b)("a",{parentName:"p",href:"http://doc.ruoyi.vip/ruoyi-cloud/other/faq.html#%E5%A6%82%E4%BD%95%E4%BF%AE%E6%94%B9%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E5%91%98%E7%99%BB%E5%BD%95%E5%AF%86%E7%A0%81"},"\u53c2\u8003\u6587\u6863\u6765\u6e90")),Object(i.b)("p",null,"\u9519\u8bef\u63d0\u793a\uff1a",Object(i.b)("inlineCode",{parentName:"p"},"Handler dispatch failed; nested exception is java.lang.NoClassDefFoundError: javax/xml/bind/DatatypeConverter")),Object(i.b)("p",null,"\u7531\u4e8e",Object(i.b)("inlineCode",{parentName:"p"},">= jdk9"),"\u4e2d\u4e0d\u518d\u5305\u542b\u8fd9\u4e2a",Object(i.b)("inlineCode",{parentName:"p"},"jar"),"\u5305\uff0c\u6240\u4ee5\u9700\u8981\u5728",Object(i.b)("inlineCode",{parentName:"p"},"ruoyi-framework\\pom.xml"),"\u624b\u52a8\u6dfb\u52a0\u4f9d\u8d56\u3002"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-xml"},"\n<dependency>\n    <groupId>javax.xml.bind</groupId>\n    <artifactId>jaxb-api</artifactId>\n    <version>2.3.0</version>\n</dependency>\n")),Object(i.b)("h2",{id:"2ruoyi-vue\u81ea\u5b9a\u4e49\u5bc6\u7801\u5339\u914d\u5668"},"2.ruoyi-vue\u81ea\u5b9a\u4e49\u5bc6\u7801\u5339\u914d\u5668"),Object(i.b)("h3",{id:"1\u7b2c\u4e00\u6b65\u91cd\u5199securityutilsencryptpasswordsecurityutilsmatchespassword\u8fd9\u4e24\u4e2a\u65b9\u6cd5"},"(1).\u7b2c\u4e00\u6b65:\u91cd\u5199SecurityUtils.encryptPassword,SecurityUtils.matchesPassword\u8fd9\u4e24\u4e2a\u65b9\u6cd5"),Object(i.b)("p",null,"\u5982:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"}," /**\n     * \u751f\u6210BCryptPasswordEncoder\u5bc6\u7801\n     *\n     * @param password \u5bc6\u7801\n     * @return \u52a0\u5bc6\u5b57\u7b26\u4e32\n     */\n    public static String encryptPassword(String password)\n    {\n        return PHPpassword.PHPpasswordHash(password);\n    }\n\n    /**\n     * \u5224\u65ad\u5bc6\u7801\u662f\u5426\u76f8\u540c\n     *\n     * @param rawPassword \u771f\u5b9e\u5bc6\u7801\n     * @param encodedPassword \u52a0\u5bc6\u540e\u5b57\u7b26\n     * @return \u7ed3\u679c\n     */\n    public static boolean matchesPassword(String rawPassword, String encodedPassword)\n    {\n        return PHPpassword.PHPpasswordVerify(rawPassword,encodedPassword);\n    }\n\n")),Object(i.b)("p",null,"PHPpassword.java\u5185\u5bb9:"),Object(i.b)("p",null,"xml\u4f9d\u8d56:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-xml"},"\x3c!--\u7528\u4e8ePHP\u5bc6\u7801\u517c\u5bb9PHPpasswordHash\u548cPHPpasswordVerify\u65b9\u6cd5--\x3e\n<dependency>\n    <groupId>at.favre.lib</groupId>\n    <artifactId>bcrypt</artifactId>\n    <version>0.9.0</version>\n</dependency>\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},'package com.ruoyi.common.utils;\n\nimport at.favre.lib.crypto.bcrypt.BCrypt;\n\npublic class PHPpassword {\n    public static void main(String[] args) {\n        String password = "admin123";\n        String hash = PHPpasswordHash(password);\n        System.out.println(hash);\n        boolean b = PHPpasswordVerify(password, hash);\n        boolean b2 = PHPpasswordVerify(password, "$2a$13$jIFK.m0PK3xWEqAGoHi5keRblfKO./A2AU/YTOt5Q.VrQIhTKqhde");\n        System.out.println(b);\n        System.out.println(b2);\n    }\n\n    /**\n     * java\u7248\u672c\u7684passwordHash\n     *\n     * @param password\n     * @return\n     */\n    public static String PHPpasswordHash(String password) {\n        return BCrypt.withDefaults().hashToString(13, password.toCharArray());\n    }\n\n    /**\n     * \u9a8c\u8bc1passsword\n     *\n     * @param password\n     * @param hashphpassword\n     * @return\n     */\n    public static boolean PHPpasswordVerify(String password, String hashphpassword) {\n        BCrypt.Result res = BCrypt.verifyer().verify(password.toCharArray(), hashphpassword);\n        return res.verified;\n    }\n}\n\n')),Object(i.b)("h3",{id:"2\u7b2c\u4e8c\u6b65\u5728securityconfig\u7c7b\u91cc\u914d\u7f6e\u81ea\u5df1\u7684\u5bc6\u7801\u5339\u914d\u5668"},"(2).\u7b2c\u4e8c\u6b65:\u5728SecurityConfig\u7c7b\u91cc\u914d\u7f6e\u81ea\u5df1\u7684\u5bc6\u7801\u5339\u914d\u5668"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},"  @Bean\n    public AuthenticationProvider authenticationProvider() {\n        AuthenticationProvider authenticationProvider = new MyAuthenticationProvider();\n        return authenticationProvider;\n    }\n")),Object(i.b)("p",null,"MyAuthenticationProvider\u7c7b\u7684\u5185\u5bb9:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},'package com.ruoyi.framework.security.service;\n\nimport com.ruoyi.common.exception.user.UserPasswordNotMatchException;\nimport com.ruoyi.common.utils.PHPpassword;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.security.authentication.AuthenticationProvider;\nimport org.springframework.security.authentication.DisabledException;\nimport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.core.AuthenticationException;\nimport org.springframework.security.core.GrantedAuthority;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.core.userdetails.UserDetailsService;\nimport org.springframework.stereotype.Component;\n\nimport java.util.Collection;\n\n@Component\npublic class MyAuthenticationProvider implements AuthenticationProvider {\n\n    @Qualifier("userDetailsServiceImpl")\n    @Autowired\n    private UserDetailsService userService;\n\n    /**\n     * \u81ea\u5b9a\u4e49\u9a8c\u8bc1\u65b9\u5f0f\n     */\n    @Override\n    public Authentication authenticate(Authentication authentication) throws AuthenticationException {\n        String username = authentication.getName();\n        String password = (String) authentication.getCredentials();\n        UserDetails user = userService.loadUserByUsername(username);\n        if (!PHPpassword.PHPpasswordVerify(password,user.getPassword())) {\n            throw new UserPasswordNotMatchException();\n        }\n\n        Collection<? extends GrantedAuthority> authorities = user.getAuthorities();\n        return new UsernamePasswordAuthenticationToken(user, password, authorities);\n    }\n\n    @Override\n    public boolean supports(Class<?> arg0) {\n        return true;\n    }\n}\n\n')),Object(i.b)("h2",{id:"3\u5728ruoyi-vue\u52a0\u8c37\u6b4c\u9a8c\u8bc1\u7801"},"3.\u5728ruoyi-vue\u52a0\u8c37\u6b4c\u9a8c\u8bc1\u7801"),Object(i.b)("h2",{id:"4\u5b57\u6bb5\u65e5\u671f\u683c\u5f0f\u5316"},"4.\u5b57\u6bb5\u65e5\u671f\u683c\u5f0f\u5316"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},' import com.fasterxml.jackson.annotation.JsonFormat;\n\n\n@JsonFormat(pattern = "yyyy-MM-dd")\nprivate Date endTime;\n\n\n\u5e26\u65f6\u5206\u79d2\u7684:\n\n@JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")\nprivate Date operTime;\n\n')),Object(i.b)("h2",{id:"5\u81ea\u5b9a\u4e49dto\u8f6c\u5316\u5668\u5982\u628a\u6570\u7ec4\u8f6c\u6210string"},"5.\u81ea\u5b9a\u4e49dto\u8f6c\u5316\u5668,\u5982,\u628a\u6570\u7ec4\u8f6c\u6210String"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},'    @Excel(name = "\u53d1\u5e03\u5bf9\u8c61")\n    @JsonSerialize(using = ArrayToStringJsonSerializer.class)\n    @JsonDeserialize(using = StringJsonDeserializer.class)\n    private String identity;\n\n')),Object(i.b)("p",null,"ArrayToStringJsonSerializer\u7684\u5185\u5bb9:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},"import com.fasterxml.jackson.core.JsonGenerator;\nimport com.fasterxml.jackson.databind.JsonSerializer;\nimport com.fasterxml.jackson.databind.SerializerProvider;\n\nimport java.io.IOException;\n\n/**\n * ArrayToStringJsonSerializer\n *\n * \n */\npublic class ArrayToStringJsonSerializer extends JsonSerializer<String> {\n\n    @Override\n    public void serialize(String value, JsonGenerator jsonGenerator, SerializerProvider serializerProvider) throws IOException {\n        String text = (value==null ? null:String.valueOf(value));\n        if (text!=null) {\n            jsonGenerator.writeString(text);\n        }\n    }\n}\n")),Object(i.b)("p",null,"StringJsonDeserializer\u7684\u5185\u5bb9:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},"import com.fasterxml.jackson.core.JsonParser;\nimport com.fasterxml.jackson.databind.DeserializationContext;\nimport com.fasterxml.jackson.databind.JsonDeserializer;\n\nimport java.io.IOException;\n\n/**\n * StringJsonDeserializer\n */\npublic class StringJsonDeserializer extends JsonDeserializer<String> {\n\n    @Override\n    public String deserialize(JsonParser jsonParser, DeserializationContext deserializationContext) throws IOException {\n        return jsonParser.getText();\n    }\n}\n")),Object(i.b)("h2",{id:"6\u5e38\u89c1mybatis\u5b9e\u4f53html"},"6.\u5e38\u89c1mybatis\u5b9e\u4f53html"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-html"},"\n<if test='createTime != null '> and CREATE_TIME &gt;= #{createTime}</if>\n<if test='updateTime != null '> and CREATE_TIME &lt;= #{updateTime}</if>\n\n\n<:\u7684\u5b9e\u4f53\u6807\u7b7e:\n  &lt;\n>:\u7684\u5b9e\u4f53\u6807\u7b7e:\n  &gt;\n\n  <>\u7684\u5b9e\u4f53\u6807\u7b7e:\n  &lt;&gt;\n\n")),Object(i.b)("h2",{id:"7-import\u5bfc\u5165\u7684\u5b9e\u73b0"},"7. import\u5bfc\u5165\u7684\u5b9e\u73b0"),Object(i.b)("h3",{id:"1-java-\u5b9e\u73b0"},"(1) java \u5b9e\u73b0"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-typescript",metastring:"jsx",jsx:!0},'\n    @Log(title = "\u5bfc\u5165\u6570\u636e", businessType = BusinessType.IMPORT)\n    @PreAuthorize("@ss.hasPermi(\'chessandcardchallenge:dataimport:import\')")\n    @PostMapping("/importData")\n    public AjaxResult importData(MultipartFile file, boolean updateSupport) throws Exception {\n        ExcelUtil<MacauChesscardchallengeDataimport> util = new ExcelUtil<>(MacauChesscardchallengeDataimport.class);\n        List<MacauChesscardchallengeDataimport> userList = util.importExcel(file.getInputStream());\n        LoginUser loginUser = tokenService.getLoginUser(ServletUtils.getRequest());\n        String operName = loginUser.getUsername();\n        String message = macauChesscardchallengeDataimportService.importUser(userList, updateSupport, operName);\n        return AjaxResult.success(message);\n    }\n    \n    @GetMapping("/importTemplate")\n    public AjaxResult importTemplate() {\n        ExcelUtil<MacauChesscardchallengeDataimport> util = new ExcelUtil<>(MacauChesscardchallengeDataimport.class);\n        return util.importTemplateExcel("\u5bfc\u5165\u6570\u636e");\n    }\n\n')),Object(i.b)("h3",{id:"2-vue\u5b9e\u73b0"},"(2) vue\u5b9e\u73b0"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-html"},"\n\n<template>\n\n  <el-col :span=\"1.5\">\n    <el-button\n      type=\"info\"\n      plain\n      icon=\"el-icon-upload2\"\n      size=\"mini\"\n      @click=\"handleImport\"\n      v-hasPermi=\"['chessandcardchallenge:dataimport:import']\"\n    >\u5bfc\u5165\n    </el-button>\n  </el-col>\n  \n  \n  \x3c!-- \u7528\u6237\u5bfc\u5165\u5bf9\u8bdd\u6846 --\x3e\n  <el-dialog :title='upload.title' :visible.sync='upload.open' width='400px' append-to-body>\n    <el-upload\n      ref='upload'\n      :limit='1'\n      accept='.xlsx, .xls'\n      :headers='upload.headers'\n      :action=\"upload.url + '?updateSupport=' + upload.updateSupport\"\n      :disabled='upload.isUploading'\n      :on-progress='handleFileUploadProgress'\n      :on-success='handleFileSuccess'\n      :auto-upload='false'\n      drag\n    >\n      <i class='el-icon-upload'></i>\n      <div class='el-upload__text'>\n        \u5c06\u6587\u4ef6\u62d6\u5230\u6b64\u5904\uff0c\u6216\n        <em>\u70b9\u51fb\u4e0a\u4f20</em>\n      </div>\n      <div class='el-upload__tip' slot='tip'>\n        <el-checkbox v-model='upload.updateSupport' />\n        \u662f\u5426\u66f4\u65b0\u5df2\u7ecf\u5b58\u5728\u7684\u7528\u6237\u6570\u636e\n        <el-link type='info' style='font-size:12px' @click='importTemplate'>\u4e0b\u8f7d\u6a21\u677f</el-link>\n      </div>\n      <div class='el-upload__tip' style='color:red' slot='tip'>\u63d0\u793a\uff1a\u4ec5\u5141\u8bb8\u5bfc\u5165\u201cxls\u201d\u6216\u201cxlsx\u201d\u683c\u5f0f\u6587\u4ef6\uff01</div>\n    </el-upload>\n    <div slot='footer' class='dialog-footer'>\n      <el-button type='primary' @click='submitFileForm'>\u786e \u5b9a</el-button>\n      <el-button @click='upload.open = false'>\u53d6 \u6d88</el-button>\n    </div>\n  </el-dialog>\n</template>\n\n<script>\nimport {getToken} from \"@/utils/auth\";\n// \u4e0b\u8f7d\u7528\u6237\u5bfc\u5165\u6a21\u677f\nfunction importTemplate() {\n  return request({\n    url: '/chessandcardchallenge/dataimport/importTemplate',\n    method: 'get'\n  })\n}\n\nexport default {\n  name: \"Dataimport\",\n  components: {},\n  data() {\n    return {\n      upload: {\n        // \u662f\u5426\u663e\u793a\u5f39\u51fa\u5c42\uff08\u6570\u636e\u5bfc\u5165\uff09\n        open: false,\n        // \u5f39\u51fa\u5c42\u6807\u9898\uff08\u6570\u636e\u5bfc\u5165\uff09\n        title: \"\",\n        // \u662f\u5426\u7981\u7528\u4e0a\u4f20\n        isUploading: false,\n        // \u662f\u5426\u66f4\u65b0\u5df2\u7ecf\u5b58\u5728\u7684\u6570\u636e\u6570\u636e\n        updateSupport: 0,\n        // \u8bbe\u7f6e\u4e0a\u4f20\u7684\u8bf7\u6c42\u5934\u90e8\n        headers: {Authorization: \"Bearer \" + getToken()},\n        // \u4e0a\u4f20\u7684\u5730\u5740\n        url: process.env.VUE_APP_BASE_API + \"/chessandcardchallenge/dataimport/importData\"\n      },\n    };\n  },\n  methods: {\n    /** \u4e0b\u8f7d\u6a21\u677f\u64cd\u4f5c */\n    importTemplate() {\n      importTemplate().then(response => {\n        this.download(response.msg);\n      });\n    },\n    // \u63d0\u4ea4\u4e0a\u4f20\u6587\u4ef6\n    submitFileForm() {\n      this.$refs.upload.submit();\n    },\n    /** \u5bfc\u5165\u6309\u94ae\u64cd\u4f5c */\n    handleImport() {\n      this.upload.title = \"\u6570\u636e\u5bfc\u5165\";\n      this.upload.open = true;\n    },\n    // \u6587\u4ef6\u4e0a\u4f20\u4e2d\u5904\u7406\n    handleFileUploadProgress(event, file, fileList) {\n      this.upload.isUploading = true;\n    },\n    // \u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u5904\u7406\n    handleFileSuccess(response, file, fileList) {\n      this.upload.open = false;\n      this.upload.isUploading = false;\n      this.$refs.upload.clearFiles();\n      this.$alert(response.msg, \"\u5bfc\u5165\u7ed3\u679c\", {dangerouslyUseHTMLString: true});\n      this.getList();\n    },\n  }\n};\n<\/script>\n\n")),Object(i.b)("h2",{id:"8ruoyi\u591a\u6570\u636e\u6e90"},"8.ruoyi\u591a\u6570\u636e\u6e90"),Object(i.b)("p",null,"\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u7ecf\u5e38\u53ef\u80fd\u9047\u5230\u5728\u4e00\u4e2a\u5e94\u7528\u4e2d\u53ef\u80fd\u9700\u8981\u8bbf\u95ee\u591a\u4e2a\u6570\u636e\u5e93\u7684\u60c5\u51b5\n\u5728\u9700\u8981\u5207\u6362\u6570\u636e\u6e90",Object(i.b)("inlineCode",{parentName:"p"},"Service"),"\u6216",Object(i.b)("inlineCode",{parentName:"p"},"Mapper"),"\u65b9\u6cd5\u4e0a\u6dfb\u52a0",Object(i.b)("inlineCode",{parentName:"p"},"@DataSource"),"\u6ce8\u89e3\n",Object(i.b)("inlineCode",{parentName:"p"},"@DataSource(value = DataSourceType.MASTER)"),"\uff0c\u5176\u4e2d",Object(i.b)("inlineCode",{parentName:"p"},"value"),"\u7528\u6765\u8868\u793a\u6570\u636e\u6e90\u540d\u79f0"),Object(i.b)("p",null,"\u63d0\u793a"),Object(i.b)("p",null,"\u5173\u4e8e\u591a\u6570\u636e\u6e90\u4f7f\u7528\u6d41\u7a0b\uff08\u5982\u679c\u6709\u591a\u4e2a\uff0c\u53ef\u4ee5\u53c2\u8003slave\u6dfb\u52a0\uff09"),Object(i.b)("p",null,"\u652f\u6301\u53c2\u6570\u5982\u4e0b\uff1a"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"\u53c2\u6570"),Object(i.b)("th",{parentName:"tr",align:null},"\u7c7b\u578b"),Object(i.b)("th",{parentName:"tr",align:null},"\u9ed8\u8ba4\u503c"),Object(i.b)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"value"),Object(i.b)("td",{parentName:"tr",align:null},"DataSourceType"),Object(i.b)("td",{parentName:"tr",align:null},"DataSourceType.MASTER"),Object(i.b)("td",{parentName:"tr",align:null},"\u4e3b\u5e93")))),Object(i.b)("p",null,"1\u3001\u5728",Object(i.b)("inlineCode",{parentName:"p"},"application-druid.yml"),"\u914d\u7f6e\u4ece\u5e93\u6570\u636e\u6e90"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"# \u4ece\u5e93\u6570\u636e\u6e90\nslave:\n    # \u4ece\u6570\u636e\u6e90\u5f00\u5173/\u9ed8\u8ba4\u5173\u95ed\n    enabled: true\n    url: jdbc:mysql://localhost:3306/test?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8\n    username: root\n    password: password\n")),Object(i.b)("p",null,"2\u3001\u5728",Object(i.b)("inlineCode",{parentName:"p"},"DataSourceType"),"\u7c7b\u6dfb\u52a0\u6570\u636e\u6e90\u679a\u4e3e"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"/**\n * \u4ece\u5e93\n */\nSLAVE\n")),Object(i.b)("p",null,"3\u3001\u5728",Object(i.b)("inlineCode",{parentName:"p"},"DruidConfig"),"\u914d\u7f6e\u8bfb\u53d6\u6570\u636e\u6e90"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},'@Bean\n@ConfigurationProperties("spring.datasource.druid.slave")\n@ConditionalOnProperty(prefix = "spring.datasource.druid.slave", name = "enabled", havingValue = "true")\npublic DataSource slaveDataSource(DruidProperties druidProperties)\n{\n    DruidDataSource dataSource = DruidDataSourceBuilder.create().build();\n    return druidProperties.dataSource(dataSource);\n}\n')),Object(i.b)("p",null,"4\u3001\u5728",Object(i.b)("inlineCode",{parentName:"p"},"DruidConfig"),"\u7c7b",Object(i.b)("inlineCode",{parentName:"p"},"dataSource"),"\u65b9\u6cd5\u6dfb\u52a0\u6570\u636e\u6e90"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},'setDataSource(targetDataSources, DataSourceType.SLAVE.name(), "slaveDataSource");\n')),Object(i.b)("p",null,"5\u3001\u5728\u9700\u8981\u4f7f\u7528\u591a\u6570\u636e\u6e90\u65b9\u6cd5\u6216\u7c7b\u4e0a\u6dfb\u52a0",Object(i.b)("inlineCode",{parentName:"p"},"@DataSource"),"\u6ce8\u89e3\uff0c\u5176\u4e2d",Object(i.b)("inlineCode",{parentName:"p"},"value"),"\u7528\u6765\u8868\u793a\u6570\u636e\u6e90"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"@DataSource(value = DataSourceType.SLAVE)\npublic List<SysUser> selectUserList(SysUser user)\n{\n    return userMapper.selectUserList(user);\n}\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"@Service\n@DataSource(value = DataSourceType.SLAVE)\npublic class SysUserServiceImpl\n")),Object(i.b)("p",null,"\u5bf9\u4e8e\u7279\u6b8a\u60c5\u51b5\u53ef\u4ee5\u901a\u8fc7",Object(i.b)("inlineCode",{parentName:"p"},"DynamicDataSourceContextHolder"),"\u624b\u52a8\u5b9e\u73b0\u6570\u636e\u6e90\u5207\u6362"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"public List<SysUser> selectUserList(SysUser user)\n{\n    DynamicDataSourceContextHolder.setDataSourceType(DataSourceType.SLAVE.name());\n    List<SysUser> userList = userMapper.selectUserList(user);\n    DynamicDataSourceContextHolder.clearDataSourceType();\n    return userList;\n}\n")),Object(i.b)("p",null,"\u903b\u8f91\u5b9e\u73b0\u4ee3\u7801 ",Object(i.b)("inlineCode",{parentName:"p"},"com.ruoyi.framework.aspectj.DataSourceAspect")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"\u6ce8\u610f\uff1a\u76ee\u524d\u914d\u7f6e\u4e86\u4e00\u4e2a\u4ece\u5e93\uff0c\u9ed8\u8ba4\u5173\u95ed\u72b6\u6001\u3002\u5982\u679c\u4e0d\u9700\u8981\u591a\u6570\u636e\u6e90\u4e0d\u7528\u505a\u4efb\u4f55\u914d\u7f6e\u3002 \u53e6\u5916\u53ef\u65b0\u589e\u591a\u4e2a\u4ece\u5e93\u3002\u652f\u6301\u4e0d\u540c\u6570\u636e\u6e90\uff08Mysql\u3001Oracle\u3001SQLServer\uff09\n")),Object(i.b)("p",null,"\u63d0\u793a"),Object(i.b)("p",null,"\u5982\u679c\u6709Service\u65b9\u6cd5\u5185\u591a\u4e2a\u6ce8\u89e3\u65e0\u6548\u7684\u60c5\u51b5\u4f7f\u7528\u5185\u90e8\u65b9\u6cd5\u8c03\u7528\nSpringUtils.getAopProxy(this).xxxxxx(xxxx);"))}c.isMDXComponent=!0},97:function(e,n,r){"use strict";r.d(n,"a",(function(){return u})),r.d(n,"b",(function(){return m}));var t=r(0),a=r.n(t);function i(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function s(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?o(Object(r),!0).forEach((function(n){i(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function l(e,n){if(null==e)return{};var r,t,a=function(e,n){if(null==e)return{};var r,t,a={},i=Object.keys(e);for(t=0;t<i.length;t++)r=i[t],n.indexOf(r)>=0||(a[r]=e[r]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)r=i[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var p=a.a.createContext({}),c=function(e){var n=a.a.useContext(p),r=n;return e&&(r="function"==typeof e?e(n):s(s({},n),e)),r},u=function(e){var n=c(e.components);return a.a.createElement(p.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},b=a.a.forwardRef((function(e,n){var r=e.components,t=e.mdxType,i=e.originalType,o=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(r),b=t,m=u["".concat(o,".").concat(b)]||u[b]||d[b]||i;return r?a.a.createElement(m,s(s({ref:n},p),{},{components:r})):a.a.createElement(m,s({ref:n},p))}));function m(e,n){var r=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var i=r.length,o=new Array(i);o[0]=b;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:t,o[1]=s;for(var p=2;p<i;p++)o[p]=r[p];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,r)}b.displayName="MDXCreateElement"}}]);